logfile "$HOME/mailfilter.log"

# mails from mailman -> inbox
if (/^X-List-Administrivia: yes/)
{
    to $DEFAULT
}

# Mailing list automagic
if ( \
        /^List-Id:.*<([0-9A-Za-z_\-]+)\.(lists\.)?(.*)>/ \
)
#     if (    (/^List-Id:.*<[a-zA-Z0-9_\-]+!./) \
#          || (/^Mailing-List:.* ![a-zA-Z0-9_\-]+!-owner@/) \
#          || (/^X-list: ![a-zA-Z0-9_\-]+/) \
#          || (/^List-Id: ![a-zA-Z0-9_\-]+!./) \
#        )
{
    LISTNAME=tolower($MATCH1)

    # convert server name from dots to hyphens
    foreach ($MATCH3) =~ /[^.]+/
    { 
        LISTDOMAIN="${LISTDOMAIN}-${MATCH}"
    }
    LISTDOMAIN=substr($LISTDOMAIN, 1)

    DESTDIR="$DEFAULT/.ML.$LISTDOMAIN.$LISTNAME"
    DESTDOMAINDIR="$DEFAULT/.ML.$LISTDOMAIN"

    `test -d $DESTDIR`
    if ( $RETURNCODE == 1 )
    {
        `test -d $DESTDOMAINDIR`
        if ( $RETURNCODE == 1 )
        {
            `maildirmake -f ML.$LISTDOMAIN  $DEFAULT`
        }
        `maildirmake -f ML.$LISTDOMAIN.$LISTNAME  $DEFAULT`
        to $DESTDIR
    }
    else
    {
        to $DESTDIR
    }
}
